<h1>Pieces</h1>
<%= link_to 'New Piece', new_piece_path %>

<div data-controller="searchbar">
  <%= form_with url: search_path, method: :get, data: { searchbar_target: "form" } do |f| %>
    <%= f.text_field :query,
                     placeholder: "Search...",
                     data: {
                       searchbar_target: "input",
                       action: "keyup->searchbar#search"
                     } %>
  <% end %>
  <div data-searchbar-target="results"></div>
</div>

<div class="random-pieces">
  <% @random_piece.each do |piece| %>
    <div class="piece">
      <h2><%= piece.name %></h2>
      <p><%= cl_image_tag(piece.photos[0].key, height: 300, width: 400, crop: :fill) if piece.photos.attached? %></p>
      <%= link_to 'Book', piece %>
    </div>
  <% end %>
</div>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Color</th>
      <th>Description</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% current_user.pieces.each do |piece| %>
      <tr>
        <td><%= piece.name %></td>
        <td><%= piece.color %></td>
        <td><%= piece.description %></td>
        <td><%= cl_image_tag(piece.photos[0].key, height: 300, width: 400, crop: :fill) if !piece.photos[0].nil? %></td>
        <td><%= link_to 'Show', piece %></td>
        <td><%= link_to 'Edit', edit_piece_path(piece) %></td>
        <td>
          <%= form_with model: piece, method: :delete, local: true do |form| %>
            <%= form.submit 'Destroy', data: { confirm: 'Are you sure?' } %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
